<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

  <style id="webmakerstyle">
    body{
      background-image: url(https://1.bp.blogspot.com/-ixW-aBLVVLY/VxkyBHjPSyI/AAAAAAAAANU/f88ecTTt8LgyGleh7z1yY_4KWpJG0QZ4gCLcB/s1600/bau-stem.JPG);
      text-align: center;
    }
    .cover {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: black;
      opacity: .3;
      z-index: 2;
    }
    .container{
      position: relative;
      z-index: 3;
    }

.text-muted{
  background-color: white;
  margin: 80px;
	color: blue;
}
.last-seconds{
  color: red;
}
.option{
  margin: 0 5px;
}

.player-selection{
  visibility: hidden;
  padding: 10px;
  border-radius: 4px;
  vertical-align: center;
  font-size: 20px;
  font-weight: bold;
  background-color: rgb(73, 206, 73);
  text-transform: capitalize;
}

.opt-container{
  display: flex;
  width: 50%;
  justify-content: center;
  margin: 5px auto;
}

.player-result h2{
    text-transform: capitalize;
}
.player-result {
    width: 48%;
    float: left;
    border: 1px solid;
    margin: 1%;
}
</style>
</head>

<body>
  <!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">

    <title>Uzay</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous">

    <link rel="icon" type="image/gif" href="./assets/images/IMG_3456.jpg" />


  </head>

  <body>

    <div class="cover"></div>
    <div class="container">
      <div class="header text-center clearfix">
        <h1 class="text-muted">PhotoBooth</h1>
      </div>
      <div class="games">
        <div class="jumbotron jumbotron-fluid" id="game-1">
          <div class="container">
            <div class="game">
              <h2>Welcome To Our Quiz</h2>
              <h3>Let's Play</h3>
              <p class="lead remaining-time">Remaining Time: <span class="timer"></span></p>
              <p class="lead question"></p>
            </div>
            <div class="results">
            </div>
          </div>
          <div class="row">
            <div class="text-center choices">
              <button class="btn btn-info btn-lg start">Start Game</button>
              <div class="options">
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

  </body>

  </html>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script>
     $(document).ready(function () {
   
    });


      function Player(name, keys) {
        this.name = name;
        this.puan = 0;
        this.correct = [];
        this.false = [];
        this.answered = {};
        this.unanswered = [];

        this.keys = keys;

        this.questionsAsked = [];

        this.answer = function (question, question_answer, guess) {
          
          if(this.questionsAsked[this.questionsAsked.length - 1] && this.questionsAsked[this.questionsAsked.length -1].question == question){
             this.questionsAsked[this.questionsAsked.length - 1] = {
              question: question,
              question_answer: question_answer,
              guess: guess,
              answerTime: Game.timerMilliseconds
            };
          }else{
          this.questionsAsked.push({
              question: question,
              question_answer: question_answer,
              guess: guess,
              answerTime: Game.timerMilliseconds
            });
          }

          console.log(this.name, 'says', question_answer, 'is', guess);            
        }.bind(this);

        this.listen = function(){      
            // -------
          var _this = this;
          window.addEventListener('keyup', function(e){
            if(Game.on != true) return 0;

            var key = e.key.toUpperCase();
            var question = Object.values(Game.questions)[Game.currentQuestion];
            var options = Object.values(Game.options)[Game.currentQuestion];
            var answer = Object.values(Game.answers)[Game.currentQuestion];

            if (key == _this.keys[0].toUpperCase() ){

             $('.player-selection')
             .filter(function (i, e) { return e.textContent.indexOf(_this.name) != -1 })
             .css('visibility', 'hidden');

            $('.option')
            .filter(function(i,e){ return e.innerText.indexOf(options[0]) != -1 })
            .parent().find('.player-selection')
            .filter(function (i, e) { return e.textContent.indexOf(_this.name) != -1 })
              .css('visibility', 'visible');

            _this.answer(question, answer, options[0]); // soru, cevap, verilen cevap
            
            } else if( key == _this.keys[1].toUpperCase() ){
            
              $('.player-selection')
                .filter(function (i, e) { return e.textContent.indexOf(_this.name) != -1 })
                .css('visibility', 'hidden');

              $('.option')
                .filter(function (i, e) { return e.innerText.indexOf(options[1]) != -1 })
                .parent().find('.player-selection')
                .filter(function (i, e) { return e.textContent.indexOf(_this.name) != -1 })
                .css('visibility', 'visible');

              _this.answer(question, answer, options[1]);
            
            }
          })
        // -------
        }.bind(this);

        this.calculateResults = function(){
          this.correct = this.questionsAsked.filter(function(question){ return question.question_answer == question.guess });
          this.false = this.questionsAsked.filter(function (question) { return question.question_answer != question.guess });
          this.unanswered = Object.keys(Game.questions).length - this.questionsAsked.length;

          var correct_times = this.correct.map(function(true_question){ return true_question.answerTime })
          this.total = correct_times.length ?  correct_times.reduce(function(a, b){ return a + b}) : 0; 
        }.bind(this);
        
        this.outputResults = function(){
          this.calculateResults();

          return '<div class="player-result">' +
            '<h2>' + this.name + '</h2>' +
            '<p>Correct: ' + this.correct.length + '</p>' +
            '<p>Incorrect: ' + this.false.length + '</p>' +
            '<p>Unanswered: ' + this.unanswered + '</p>' +
            '<p>Total: ' + this.total + '</p>' +
            '<p>Please play again!</p>' +
            '</div>';
        }.bind(this);

        return this;
      }

           
      var Game = {
        currentQuestion : 0,
        timer : null,
        timerMilliseconds: null,
        timerId : null,
        $container : $(`#game-1`),
        on: false,
        startGame: function(player1, player2) {
          Game.on = true;
          Game.currentQuestion = 0;
          clearInterval(Game.timerId);

          Game.$container.find('.game').show();
          
          Game.$container.find('.results').html('');
          Game.$container.find('.timer').text(Game.timerMilliseconds);
          Game.$container.find('.start').hide();
          Game.$container.find('.remaining-time').show();
          Game.player1 = player1;
          Game.player2 = player2;
          
          Game.player1.listen();
          Game.player2.listen();
          
          Game.nextQuestion();

        },
        endGame: function () {
          Game.on = false;
          clearInterval(Game.timerId);
          Game.$container.find('.results')
            .html('<h3>Thank you for playing!</h3>' + Game.player1.outputResults() + Game.player2.outputResults() );

          Game.$container.find('.game').hide();
          Game.$container.find('.start').show();
        },
          nextQuestion: function() {
            Game.timerMilliseconds = 5000;
            Game.$container.find('.timer').removeClass('last-seconds');
            Game.$container.find('.timer').text(Game.timer);
            // bu timerRunning her saniye execute olacak
            Game.timerId = setInterval(Game.timerRunning, 10);
            // soru metni
            var questionContent = Object.values(Game.questions)[Game.currentQuestion];
            // soru metni render
            Game.$container.find('.question').text(questionContent);
            // seçenekler
            var questionOptions = Object.values(Game.options)[Game.currentQuestion];
            
            // seçenekler render
            $.each(questionOptions, function (index, key) {
              Game.$container.find('.options').append($('<div class="opt-container"> <div class="player-selection"> '+Game.player1.name+' </div>  <button class="option btn btn-info btn-lg">  <span class="val">' + key + '</span></button> <div class="player-selection"> ' + Game.player2.name +' </div> </div>'));
            })
          },
          timerRunning: function() {
            // zaman geçiyor
            Game.timerMilliseconds -= 10;
            // zamanı render ediyoruz
            Game.$container.find('.timer').text(Math.round(Game.timerMilliseconds/100)/10);

            if (Game.timerMilliseconds > -1 && Game.currentQuestion < Object.keys(Game.questions).length) {
              if (Game.timerMilliseconds === 4000) {
                Game.$container.find('.timer').addClass('last-seconds');
              }
            }
            if (Game.timerMilliseconds <= 0) {
              // zaman saniye doldu
              Game.result = false;
              clearInterval(Game.timerId);
              Game.$container.find('.results').html('<h3>Out of time! The answer was ' + Object.values(Game.answers)[Game.currentQuestion] + '</h3>');
              
              Game.currentQuestion++
              setTimeout(function(){
                Game.$container.find('.opt-container').remove();
                Game.$container.find('.results h3').remove();
                Game.nextQuestion();
                }, 1200);
            }
            else if (Game.currentQuestion === Object.keys(Game.questions).length) {
              // Son soru
              Game.endGame();
            }
          },
          loadQuestions: function(question_data){
            Game.questions = question_data.questions;
            Game.options = question_data.options;
            Game.answers = question_data.answers;
          
          }

        }

  // ********************* **************************** ************************** *******
        
var yusuf = new Player('yusuf', ['a', 's']);
var ali = new Player('ali', ['d', 'w']);

Game.$container.find(".remaining-time").hide();
Game.$container.find(".start").on('click', function(){
  Game.startGame(ali, yusuf)
  });

var question_data = {
  questions: {
    q1: 'Uzay Kimdir ?',
    q2: 'Uzayın hangi sebzeye alerjisi vardır ?',
    q3: 'Uzayın boyu kaç metredir ?',
    q4: 'Uzay kaç ülkeye gitmiştir ?',
    q5: "Uzay kaç kilodur?",
    q6: 'Uzay hangi ülkede yaşamak istiyor ?',
  },
    options: {
      q1: ['Müzisyen', 'Dansöz'],
      q2: ['Domates', 'Brokoli'],
      q3: ['1.92', '1.95'],
      q4: ['17', '20'],
      q5: ['115', '120'],
      q6: ['Hollanda', 'Kanada'],
    },
    answers: {
      q1: 'Müzisyen',
      q2: 'Domates',
      q3: '1.92',
      q4: '17',
      q5: '115',
      q6: 'Kanada',
    }
  };
  Game.loadQuestions(question_data);

  Game.startGame(yusuf, ali);


  </script>
</body>

</html>
